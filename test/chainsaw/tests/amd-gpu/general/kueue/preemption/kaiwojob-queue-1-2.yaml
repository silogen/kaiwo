apiVersion: kaiwo.silogen.ai/v1alpha1
kind: KaiwoJob
metadata:
  name: kaiwojob-1-2
spec:
  gpuResources:
    count: 3
  dangerous: true
  image: rocm/pytorch:rocm6.4_ubuntu24.04_py3.12_pytorch_release_2.6.0
  clusterQueue: queue-1
  resources:
    requests:
      cpu: "2"
      memory: "8Gi"
    limits:
      cpu: "2"
      memory: "8Gi"
  entrypoint: |
    python3 - << 'EOF'
    import signal
    import sys
    import torch

    def signal_handler(sig, frame):
        print('Termination signal received. Exiting...')
        sys.exit(0)

    signal.signal(signal.SIGTERM, signal_handler)
    signal.signal(signal.SIGINT, signal_handler)

    dev = torch.device('cuda')
    a = torch.rand((4096, 4096), device=dev)
    try:
        while True:
            _ = torch.mm(a, a)
    except KeyboardInterrupt:
        print('Interrupted. Exiting...')
        sys.exit(0)
    EOF
