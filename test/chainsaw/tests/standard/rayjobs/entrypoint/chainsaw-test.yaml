apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: ray-entrypoint
spec:
  steps:
    - try:
        - apply:
            resource:
              apiVersion: kaiwo.silogen.ai/v1alpha1
              kind: KaiwoJob
              metadata:
                name: ray-entrypoint-test
              spec:
                resources:
                  limits:
                    cpu: "1"
                    memory: "2Gi"
                  requests:
                    cpu: "1"
                    memory: "2Gi"
                user: test@amd.com
                ray: true
                image: ghcr.io/silogen/ray-test:v0.3
                entrypoint: |
                  ls \
                    -lah
                  echo "hello-ray"
                  sleep 20
        - assert:
            timeout: 120s
            resource:
              apiVersion: v1
              kind: Pod
              metadata:
                labels:
                  job-name: ray-entrypoint-test
        - sleep:
            duration: 15s
        - script:
#            timeout: 90s
            content: ../../../../scripts/read_pod_logs.sh job-name=ray-entrypoint-test "$NAMESPACE"
            env:
              - name: NAMESPACE
                value: ($namespace)
            check:
              (contains($stdout, 'hello-ray')): true
#        - assert:
#            resource:
#              apiVersion: kaiwo.silogen.ai/v1alpha1
#              kind: KaiwoJob
#              metadata:
#                name: ray-entrypoint-test
#              status:
#                status: COMPLETE