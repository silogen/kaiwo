apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: workload-priority-class
spec:
  steps:
  - name: Create priority class
    try:
    - apply:
        file: workload_priority_class.yaml
  - name: Batch job
    try:
    - apply:
        file: batchjob.yaml
    - assert:
        resource:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: kaiwojob-1
            labels:
              kueue.x-k8s.io/priority-class: test-workload-priority-class
  - name: Ray job
    try:
    - apply:
        file: rayjob.yaml
    - assert:
        resource:
          apiVersion: ray.io/v1
          kind: RayJob
          metadata:
            name: kaiwojob-1
            labels:
              kueue.x-k8s.io/priority-class: test-workload-priority-class
  - name: Deployment
    try:
    - apply:
        file: deployment.yaml
    - assert:
        resource:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: kaiwoservice-1
          spec:
            template:
              metadata:
                labels:
                  kueue.x-k8s.io/priority-class: test-workload-priority-class
  - name: Ray service
    try:
    - apply:
        file: rayservice.yaml
    - assert:
        resource:
          apiVersion: workload.codeflare.dev/v1beta2
          kind: AppWrapper
          metadata:
            name: kaiwoservice-1
            labels:
              kueue.x-k8s.io/priority-class: test-workload-priority-class
